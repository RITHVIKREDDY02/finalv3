# IMMEDIATE VPS FIX - Run this on your VPS now:

cd /var/www

# Stop broken app
pm2 delete tashan-win-vip

# Create a simple standalone server file that works
cat > simple-server.js << 'EOF'
import express from 'express';
import path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

const app = express();
app.use(express.json());
app.use(express.static(path.join(__dirname, 'dist/public')));

// Simple games API endpoint
app.get('/api/games', (req, res) => {
  const games = [
    { id: '1', gameName: 'Win Go', isEnabled: true },
    { id: '2', gameName: 'Trx Wingo', isEnabled: true },
    { id: '3', gameName: 'K3', isEnabled: true },
    { id: '4', gameName: 'Moto Racing', isEnabled: true },
    { id: '5', gameName: 'Mines Pro', isEnabled: true },
    { id: '6', gameName: 'Mines', isEnabled: true },
    { id: '7', gameName: 'Boom', isEnabled: true },
    { id: '8', gameName: 'Aviator', isEnabled: true },
    { id: '9', gameName: 'Limbo', isEnabled: true }
  ];
  res.json(games);
});

// Serve frontend
app.get('*', (req, res) => {
  res.sendFile(path.join(__dirname, 'dist/public/index.html'));
});

const port = process.env.PORT || 5009;
app.listen(port, '0.0.0.0', () => {
  console.log(`ðŸš€ Server running on port ${port}`);
});
EOF

# Install just express
npm install express

# Update PM2 config to use simple server
cat > simple-ecosystem.config.cjs << 'EOF'
module.exports = {
  apps: [{
    name: 'tashan-win-vip',
    script: 'simple-server.js',
    instances: 1,
    exec_mode: 'fork',
    env: {
      NODE_ENV: 'production',
      PORT: 5009
    },
    max_memory_restart: '512M',
    autorestart: true
  }]
};
EOF

# Start with simple server
pm2 start simple-ecosystem.config.cjs --env production

# Check status
pm2 status
pm2 logs tashan-win-vip --lines 5
curl http://localhost:5009/api/games