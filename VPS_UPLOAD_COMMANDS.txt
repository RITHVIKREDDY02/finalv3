# COMPLETE VPS DEPLOYMENT FIX

# Run these commands on your VPS to deploy the freshly built version:

cd /var/www

# Stop the current app
pm2 delete tashan-win-vip

# Create a backup of current broken version
mv dist dist-broken-backup

# You need to upload the new 'dist' folder from your development environment
# The dist folder now contains the properly built version with correct dependencies

# After uploading the new dist folder, run:
cd dist

# Create the production package.json (if not already there)
cat > package.json << 'EOF'
{
  "name": "tashan-win-vip-production",
  "version": "1.0.0",
  "type": "module",
  "license": "MIT",
  "main": "index.js",
  "scripts": {
    "start": "node index.js"
  },
  "dependencies": {
    "express": "^4.21.2",
    "cors": "^2.8.5",
    "ws": "^8.18.0",
    "zod": "^3.24.2",
    "zod-validation-error": "^3.4.0"
  }
}
EOF

# Install dependencies
npm install --production

cd ..

# Start the application
export NODE_ENV=production
export PORT=5009
pm2 start ecosystem.config.cjs --env production

# Check status
pm2 status
pm2 logs tashan-win-vip --lines 10
curl http://localhost:5009/api/games